$NetBSD: README.gcc12,v 1.7 2023/08/04 14:54:40 rin Exp $


new stuff:
	libmpx
	liboffloadmic
	libvtv
	libcet
	libphobos
	d
	gfortran
	libbacktrace: +dwarf5_CFLAGS = $(libbacktrace_TEST_CFLAGS) -gdwarf-5
	c++tools

todo:
	- audit all uses of new warning-disable variables and
	  convert some from -Wno- to -Wno-error=

arch/feature list.

tools:		does build.sh tools work?
kernels:	does a kernel run?  y (yes), b (builds/ready), p (partially), ? (not ready)
libgcc:		does libgcc build?
native-gcc:	does a full mknative-gcc complete?
sani:		has sanitizer been ported to this CPU again for GCC 12?  b (build) y (works)
make release:	does build.sh release complete?  (before sanitizer - bs)
runs:		does the system boot with a full world?
atf:		does atf run / compare well
switched:	has port switched?  y (yes), n (no/ready), ? (not ready)


architecture	tools	kernels	libgcc	native-gcc/sani	make release[2]	runs	atf	switched
------------	-----	-------	------	---------------	------------	----	---	--------
aarch64		y	y	y	y	n[12]	y		y	y	?
aarch64eb	y	y	y	y	b	y		y	y	?
alpha		y	y	y	y	b	y		y	y	?
earmv4		y	b	?	y	?	?		?	?	?
earmv4eb	y	b	?	y	?	?		?	?	?
earmv5		y	b	?	y	?	?		?	?	?
earmv5eb	y	b	?	y	?	?		?	?	?
earmv5hf	y	b	?	y	?	?		?	?	?
earmv5hfeb	y	b	?	y	?	?		?	?	?
earmv6		y	b	?	y	?	?		?	?	?
earmv6eb	y	b	?	y	?	?		?	?	?
earmv6hf	y	b	?	y	?	y		?	?	?
earmv6hfeb	y	b	?	y	?	?		?	?	?
earmv7		y	b	y	y	?	?		?	?	?
earmv7eb	y	b	?	y	?	?		?	?	?
earmv7hf	y	b	?	y	b	y		?	?	?
earmv7hfeb	y	b	?	y	b	y		?	?	?
hppa		y	b	y	y	?	n[5]		?	?	?
i386		y	b	y	y	y	y		?	?	?
ia64		y	b	y	y	y	y		y[3]	n	?
m68000		y	y	y	y	n[11]	n		y[14]	?	?
m68k		y	y	y	y	b	y		y[14]	p[15]	?
mipseb		y	b	y	y	b	y		?	?	?
mipsel		y	b	y	y	b	y		?	?	?
mips64eb	y	b	y	y	b	y		?	?	?
mips64el	y	b	y	y	b	y		?	?	?
powerpc		y	?	y	y	?	n[4]		?	?	?
powerpc64	y	?	?	y	?	?		?	?	?
sh3eb		y	?	y	y	?	?		?	?	?
sh3el		y	?	y	y	?	?		?	?	?
sparc		y	y	y	y	b	y		y	?	?
sparc64		y	b	y	y	b	y		?	?	?
vax		y	?	y	y	?	n		?	?	?
x86_64		y	y	y	y	y[13]	y		y	y	?
riscv32		y	y	y	y	b	y		?	?	?
riscv64		y	y	y	y	b	y		?	?	?
------------	-----	-------	------	---------------	------------	----	---
architecture	tools	kernels	libgcc	native-gcc/sani	make release	runs	atf

[2]: while libsanitizer is not re-ported, "make release" does not include it.
[3]: GENERIC.SKI boots just as well as GCC 10.
[4]: rs6000 has a new generator for rs6000-builtins.cc and rs6000-builtins.h rs6000-vecdefines.h
[5]: GCC itself fails to build:
     build-print-rtl.c: In constructor 'rtx_writer::rtx_writer(FILE*, int, bool, bool, rtx_reuse_manager*)':
     build-print-rtl.c:90:3: error: class 'rtx_writer' does not have any field named 'm_rtx_reuse_manager'
[7]: fails to build kernels:
     In file included from sys/arch/powerpc/oea/pmap64.c:4:
     sys/arch/powerpc/oea/pmap.c:2186:2: error: #error PPC_OEA64 not supported
[8]: destdir.evbsh3/usr/include/ssp/string.h: In function '_int_strtod_l':
     destdir.evbsh3/usr/include/ssp/string.h:82:1: error: inlining failed in call to 'always_inline' '__memcpy_ichk': target specific option mismatch
     82 | __ssp_bos_icheck3_restrict(memcpy, void *, const void *)
        | ^~~~~~~~~~~~~~~~~~~~~~~~~~
     src/lib/libc/gdtoa/gdtoaimp.h:534:20: note: called from here
     534 | #define Bcopy(x,y) memcpy(&x->sign,&y->sign,y->wds*sizeof(ULong) + 2*sizeof(int))
     src/lib/libc/gdtoa/strtod.c:582:17: note: in expansion of macro 'Bcopy'
     582 |                 Bcopy(bd, bd0);
[10]: libc.so fails to link with weird relocation errors:
      vax--netbsdelf/bin/ld: warning: dynamic relocation to `?' in readonly section `.eh_frame'
[11]: sanitizers don't build yet.
[12]: sanitizers crash early:
      (gdb) bt
      #0  0x0000f8ae19f9f424 in __sanitizer::CheckASLR () at /usr/src/external/gpl3/gcc/dist/libsanitizer/sanitizer_common/sanitizer_linux.cpp:2179
      #1  0x0000f8ae19ee1668 in __asan::AsanInitInternal () at /usr/src/external/gpl3/gcc/dist/libsanitizer/asan/asan_rtl.cpp:445
      #2  0x0000f8ae19ee1834 in __asan::AsanInitInternal () at /usr/src/external/gpl3/gcc/dist/libsanitizer/asan/asan_rtl.cpp:394
      #3  0x0000f8ae19f19e40 in __interceptor_pthread_mutex_lock (m=0xf8ae19c102c8 <__gthread_active_mutex.0>)
[13]: on amd64, with very basic test, lsan, ubsan, and asan work, but tsan crashes at start up:
      ThreadSanitizer: CHECK failed: tsan_rtl.cpp:149 "((reinterpret_cast<uptr>(this) % 64)) == ((0))" (0x10, 0x0) (tid=21499)
      ThreadSanitizer:DEADLYSIGNAL
      ==21499==ERROR: ThreadSanitizer: SEGV on unknown address 0x000000000017 (pc 0x7f7ff4e5e14e bp 0x7f7fffffdbd0 sp 0x7f7fffffdb40 T21499)
      ==21499==The signal is caused by a READ memory access.
      ==21499==Hint: address points to the zero page.
      ThreadSanitizer:DEADLYSIGNAL
      ThreadSanitizer: nested bug in the same thread, aborting.
[14]: "dd count=1" aborts. "COPTS.strsuftoll.c+=-fno-stack-protector" works around the problem.
[15]: No regression observed for tests/lib/libc/{sys,gen}.


CPU vs platform test table (for CPUs with multiple ports).  this is "make release" or just kernels.
values:		y (yes), k (kernels only), n (failed), r (running), ? (not attempted), nx (yes, no x11)

CPU		platform list
---		-------- ----
		acorn32		cats	epoc32	evbarm-eb	evbarm-el	hpcarm		iyonix		netwinder	shark 		zaurus
earmv4:		k		k	k	k		k		k		 		k		y		 
earm:		 		 	 	k		k		 		k		 		 		k
earmhf:		 		 	 	k		k		 		 		 		 		 
earmv6:		 		 	 	k		k
earmv6hf:	 		 	 	k		k
earmv7:		 		 	 	k		k
earmv7hf:	 		 	 	k		k

		amiga		atari	cesfic	hp300		luna68k		mac68k		mvme68k		news68k		next68k		sun3	x68k
m68k:		y		k	k	k		k		k		k		k		k		k 	k

		evbmips		emips		ews4800mips	mipsco		newsmips	sgimips
mipseb:		k		k		k		k		k		y

		evbmips		algor		arc		cobalt		hpcmips		pmax
mipsel:		k		k		k		k		k		y

		algor		evbmips		pmax
mips64eb:	 		r		 
mips64el:	k		r		r

		amigappc	bebox	evbppc	ibmnws		macppc		mvmeppc		ofppc		prep		rs6000		sandpoint
powerpc:	k		k	k	k		kn[4]		k		k		k		k		k

		evbppc		macppc		ofppc
powerpc64:	k		k		n[7]

		dreamcast	evbsh3		hpcsh		landisk		mmeye
sh3eb:		 		kn[8]		 		 		k
sh3el:		k		kn[8]		k		k
